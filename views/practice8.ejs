<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Products CRUD (MongoDB)</title>
  <link rel="stylesheet" href="/css/practice8.css">
</head>
<body>

<h1>Products CRUD</h1>

<!-- Add Product -->
<div class="card">
  <h2>Add Product</h2>
  <input id="name" placeholder="Product Name">
  <input id="price" type="number" placeholder="Price">
  <button onclick="addProduct()">Add</button>
</div>

<!-- Products List -->
<div class="card">
  <h2>Products List</h2>
  <button onclick="getProducts()">Show All</button>
  <ul id="products"></ul>
</div>

<!-- Update Product -->
<div class="card">
  <h2>Update Product</h2>
  <input id="updateId" placeholder="Product ID">
  <input id="updateName" placeholder="New Name">
  <input id="updatePrice" type="number" placeholder="New Price">
  <button onclick="updateProduct()">Update</button>
</div>

<!-- Delete Product -->
<div class="card">
  <h2>Delete Product</h2>
  <input id="deleteId" placeholder="Product ID">
  <button onclick="deleteProduct()">Delete</button>
</div>

<script>
const API = '/api/products';

// SHOW PRODUCTS
async function getProducts() {
  const res = await fetch(API);
  const data = await res.json();

  const list = document.getElementById('products');
  list.innerHTML = '';

  data.products.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `ID: ${p._id} | Name: ${p.name} | Price: $${p.price}`;
    list.appendChild(li);
  });
}

// ADD PRODUCT
async function addProduct() {
  const body = {
    name: document.getElementById('name').value,
    price: parseFloat(document.getElementById('price').value)
  };

  if (!body.name || isNaN(body.price)) return alert('Please enter valid name and price');

  const res = await fetch(API, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  if (!res.ok) return alert(data.error);

  alert(`Product added: ${data.name} - $${data.price}`);
  getProducts();
}

// UPDATE PRODUCT
async function updateProduct() {
  const id = document.getElementById('updateId').value;
  const body = {
    name: document.getElementById('updateName').value,
    price: parseFloat(document.getElementById('updatePrice').value)
  };

  if (!id) return alert('Product ID is required!');

  const res = await fetch(`${API}/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  if (!res.ok) return alert(data.error);

  alert(`Product updated: ${data.name} - $${data.price}`);
  getProducts();
}

// DELETE PRODUCT
async function deleteProduct() {
  const id = document.getElementById('deleteId').value;
  if (!id) return alert('Product ID is required!');

  const res = await fetch(`${API}/${id}`, { method: 'DELETE' });
  const data = await res.json();

  if (!res.ok) return alert(data.error);

  alert(data.message);
  getProducts();
}

// Load products on page load
getProducts();
</script>

</body>
</html>
